!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(t=>setTimeout(t,10));var n,c,e,o,i,y,l,p,d,s,r,u,m,t,a,h,f,g,T,S,P,b,w,k,E,L,v,C,x,A,I,O,R,_;n=Object.create,c=Object.defineProperty,e=Object.defineProperties,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,p=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,e)=>a in t?c(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,u=(t,a)=>{for(var e in a=a||{})d.call(a,e)&&r(t,e,a[e]);if(l)for(var e of l(a))s.call(a,e)&&r(t,e,a[e]);return t},m=(t,a)=>e(t,i(a)),a=(t,a,e)=>{e=null!=t?n(p(t)):{};var i=!a&&t&&t.__esModule?e:c(e,"default",{value:t,enumerable:!0}),l=t,s=void 0,r=void 0;if(l&&"object"==typeof l||"function"==typeof l)for(let t of y(l))d.call(i,t)||t===s||c(i,t,{get:()=>l[t],enumerable:!(r=o(l,t))||r.enumerable});return i},h=(t=(t,a)=>function(){return a||(0,t[y(t)[0]])((a={exports:{}}).exports,a),a.exports})({"external-global-plugin:react"(t,a){a.exports=Spicetify.React}}),t=t({"external-global-plugin:react-dom"(t,a){a.exports=Spicetify.ReactDOM}}),f=a(h()),g=a(t()),T={DEFAULT_ROW_HEIGHT:"56px",MAX_POSSIBLE_LABEL_COUNT:20,MIN_VIEW_SIZE:516,DB_NAME:"spicetify-playlist-labels",DB_VERSION:2,CSS_VARS:{MAX_LABEL_COUNT:"--spicetify-playlist-labels-max-label-count",LABEL_COUNT:"--spicetify-playlist-labels-label-count",SIZE:"--spicetify-playlist-labels-size"},STORAGE_KEYS:{SHOW_ALL:"spicetify-playlist-labels:show-all",LIKED_TRACKS_COUNT:"spicetify-playlist-labels:liked-tracks-count"},SELECTORS:{MAIN:"main",MAIN_VIEW:".Root__main-view",TRACKLIST:".main-trackList-indexable",TRACK_ROW:".main-trackList-trackListRow",LAST_COLUMN:".main-trackList-rowSectionEnd",STATS_APP:"#stats-app .main-rootlist-wrapper"},PATHS:{LIKED_TRACKS:"/collection/tracks",PLAYLIST:"/playlist/"},LIKED_SONGS_IMAGE:"https://misc.scdn.co/liked-songs/liked-songs-300.png"},S={LABEL_CONTAINER:"spicetify-playlist-labels",LABELS_CONTAINER:"spicetify-playlist-labels-labels-container",OVERFLOW:"spicetify-playlist-labels-overflow",TRACK_CONTAINER:"spicetify-playlist-labels-label-container"},P=new class{constructor(){this.state={oldMainElement:null,mainElement:null,tracklists:[],oldTracklists:[],trackUriToPlaylistData:{},playlistUpdated:!1,showAllPlaylists:!1,highlightTrack:null,highlightTrackPath:null,maxExistingLabelCount:0,maxLabelCount:1,rowHeight:T.DEFAULT_ROW_HEIGHT,mainView:null}}getState(){return this.state}updateMainElement(t){this.state.oldMainElement=this.state.mainElement,this.state.mainElement=t}updateTracklists(t){this.state.oldTracklists=this.state.tracklists,this.state.tracklists=t}setTrackUriToPlaylistData(t){this.state.trackUriToPlaylistData=t}markPlaylistUpdated(){this.state.playlistUpdated=!0}resetPlaylistUpdated(){this.state.playlistUpdated=!1}toggleShowAllPlaylists(){return this.state.showAllPlaylists=!this.state.showAllPlaylists,this.state.showAllPlaylists}setShowAllPlaylists(t){this.state.showAllPlaylists=t}setHighlightTrack(t,a){this.state.highlightTrack=t,this.state.highlightTrackPath=a}updateMaxLabelCount(t){this.state.maxLabelCount=t}updateMaxExistingLabelCount(t){t>this.state.maxExistingLabelCount&&(this.state.maxExistingLabelCount=t)}resetMaxExistingLabelCount(){this.state.maxExistingLabelCount=0}updateRowHeight(t){this.state.rowHeight=t}setMainView(t){this.state.mainView=t}hasTracklistsChanged(){return this.state.oldTracklists.length!==this.state.tracklists.length||!this.state.oldTracklists.every((t,a)=>t===this.state.tracklists[a])}hasMainElementChanged(){return!!this.state.mainElement&&!this.state.mainElement.isEqualNode(this.state.oldMainElement)}},b=new class{calculateMaxLabelCount(){var t,a,e,i,l=P.getState();l.mainView&&(i=l.mainView.getBoundingClientRect(),t=l.rowHeight===T.DEFAULT_ROW_HEIGHT?44:32,a=T.MIN_VIEW_SIZE,e=T.MAX_POSSIBLE_LABEL_COUNT,(i=this.calculateLabelCountByWidth(i.width,t,a,e))!==l.maxLabelCount)&&(P.updateMaxLabelCount(i),N(T.CSS_VARS.MAX_LABEL_COUNT,""+i),P.markPlaylistUpdated())}calculateLabelCountByWidth(a,e,i,l){if(a<=i)return 1;for(let t=1;t<l-1;t++){var s=i+1+e*(t-1),r=i+1+e*t;if(s<=a&&a<=r)return t+1}return i+1+e*(l-2)<=a?l:1}updateRowHeight(t){t!==P.getState().rowHeight&&(P.updateRowHeight(t),N(T.CSS_VARS.SIZE,`calc(${t} * 0.5)`),this.calculateMaxLabelCount(),P.markPlaylistUpdated())}updateMaxExistingLabelCount(t){t>P.getState().maxExistingLabelCount&&(P.updateMaxExistingLabelCount(t),N(T.CSS_VARS.LABEL_COUNT,""+t))}resetLayout(){P.resetMaxExistingLabelCount()}},w=a(h()),k=a(h()),E=({playlistData:a,trackUri:e,onNavigateToPlaylist:i})=>{a.isLikedTracks||(Spicetify.ReactComponent.Menu,Spicetify.ReactComponent.MenuItem,Spicetify.ReactComponent.IconComponent,Spicetify.SVGIcons.trash,a.name);return k.default.createElement(Spicetify.ReactComponent.TooltipWrapper,{label:a.name,placement:"top"},k.default.createElement("div",null,k.default.createElement("div",{className:S.TRACK_CONTAINER,style:{cursor:"pointer"},onClick:t=>{t.stopPropagation(),i(a,e)}},a.image&&k.default.createElement("img",{src:a.image,alt:a.name}))))},L=({playlistData:t,trackUri:a,maxLabelCount:e,onRemoveTrack:i,onNavigateToPlaylist:l})=>{var s=t.length>e,t=t.slice(0,e),e=s?S.LABELS_CONTAINER+" "+S.OVERFLOW:S.LABELS_CONTAINER;return w.default.createElement("div",{className:e},t.map(t=>w.default.createElement(E,{key:t.uri||"liked-tracks",playlistData:t,trackUri:a,onRemoveTrack:i,onNavigateToPlaylist:l})))},v=new class{constructor(){this.db=null}async getDb(){return this.db||new Promise((a,t)=>{var e=indexedDB.open(T.DB_NAME,T.DB_VERSION);e.onerror=()=>{t(new Error("Failed to open IndexedDB"))},e.onupgradeneeded=t=>{t=t.target.result;t.objectStoreNames.contains("playlists")||t.createObjectStore("playlists",{keyPath:"uri"}),t.objectStoreNames.contains("playlistItems")||t.createObjectStore("playlistItems",{keyPath:"uri"}),t.objectStoreNames.contains("playlistMetadata")||t.createObjectStore("playlistMetadata",{keyPath:"uri"})},e.onsuccess=t=>{this.db=t.target.result,a(this.db)}})}async getCachedPlaylists(t){return this.performTransaction(t,"playlists","readonly",t=>t.getAll())}async getCachedPlaylistItems(t){return this.performTransaction(t,"playlistItems","readonly",t=>t.getAll())}async cachePlaylists(t,e){return this.performTransaction(t,"playlists","readwrite",a=>{e.forEach(t=>a.put(t))})}async cachePlaylistItems(t,a){return this.performTransaction(t,"playlistItems","readwrite",e=>{Object.entries(a).forEach(([t,a])=>{e.put({uri:t,items:a})})})}async clearCachedPlaylists(t){return this.performTransaction(t,"playlists","readwrite",t=>t.clear())}async clearCachedPlaylistItems(t){return this.performTransaction(t,"playlistItems","readwrite",t=>t.clear())}async getCachedPlaylistMetadata(t,a){return this.performTransaction(t,"playlistMetadata","readonly",t=>t.get(a))}async cachePlaylistMetadata(t,a){return this.performTransaction(t,"playlistMetadata","readwrite",t=>{t.put(a)})}async performTransaction(s,r,n,c){return new Promise((t,a)=>{const e=s.transaction(r,n);var i=e.objectStore(r);const l=c(i);l?(l.onsuccess=()=>t(l.result),l.onerror=()=>a(new Error("Transaction failed: "+l.error))):(e.oncomplete=()=>t(void 0),e.onerror=()=>a(new Error("Transaction failed: "+e.error)))})}},x=new class{getPlaylistsFromContents(t){const e=[],i=[],l=(a,t)=>{"playlist"===a.type?(t?i:e).push(a):"folder"===a.type&&a.items&&a.items.forEach(t=>l(t,"Rated"===a.name))};return l(t,!1),[e,i]}async getPlaylistsExtra(){var t=await j();const[a,e]=this.getPlaylistsFromContents(t);return[...a,...e].map(a=>m(u({},a),{isRatedPlaylist:e.some(t=>t.uri===a.uri)}))}async addPlaylists(l,t,a){var e,s;for(const c of t){var r=null!=(r=a[c.uri])?r:[];let i=null==(e=null==(e=c.images)?void 0:e[0])?void 0:e.url;if(!i)try{var n=await W(c.uri);null!=(s=null==n?void 0:n.images)&&s.length&&(i=n.images[0].url)}catch(t){console.error("Failed to get metadata for playlist:",c.name,t)}r.forEach(t=>{var a=t.uri,e=(l[a]||(l[a]=[]),l[a].some(t=>t.uri===c.uri));e||l[a].push({uri:c.uri,name:c.name,trackUid:t.uid,image:i||"",isOwnPlaylist:c.isOwnedBySelf,isLikedTracks:!1})})}}addLikedTracks(i,t){t.forEach(t=>{var a=t.uri,e=(i[a]||(i[a]=[]),i[a].some(t=>t.isLikedTracks));e||i[a].push({uri:null,name:"Liked Songs",trackUid:t.uid,image:T.LIKED_SONGS_IMAGE,isOwnPlaylist:!0,isLikedTracks:!0})})}async buildTrackUriToPlaylistData(t,a,e){var i={},[t,l]=$(Y(t));return await this.addPlaylists(i,t,a),e&&this.addLikedTracks(i,e),await this.addPlaylists(i,l,a),i}async updatePlaylistData(t){var a=await v.getDb(),e=await this.getPlaylistsExtra(),i=D(await v.getCachedPlaylistItems(a)),l=await G(t),a=(i[t]=l,await v.cachePlaylists(a,e),await v.cachePlaylistItems(a,{[t]:l}),i.likedTracks);return this.buildTrackUriToPlaylistData(e,i,a)}async updateLikedTracks(){var t=await v.getDb(),a=await v.getCachedPlaylists(t),e=D(await v.getCachedPlaylistItems(t)),i=(await q()).items,t=(await v.cachePlaylistItems(t,{likedTracks:i}),localStorage.setItem(T.STORAGE_KEYS.LIKED_TRACKS_COUNT,""+i.length),Y(a));return this.buildTrackUriToPlaylistData(t,e,i)}async getTrackUriToPlaylistData(){var t=await v.getDb();const e=await v.getCachedPlaylists(t);var a=await v.getCachedPlaylistItems(t),i=await this.getPlaylistsExtra(),l=i.filter(a=>{var t=e.find(t=>t.uri===a.uri);return X(a,t)}),a=D(a),s=l.map(a=>G(a.uri).catch(t=>(console.error(`Failed to fetch items for playlist ${a.name} (${a.uri}):`,t),null)));const r=await Promise.all(s),n=u({},a);l.forEach((t,a)=>{a=r[a];null!==a&&(n[t.uri]=a)});s=parseInt(localStorage.getItem(T.STORAGE_KEYS.LIKED_TRACKS_COUNT)||"0"),a=await V();let c=n.likedTracks;return c&&s===a||(l=await q(),c=l.items,n.likedTracks=c),await v.clearCachedPlaylists(t),await v.clearCachedPlaylistItems(t),await v.cachePlaylists(t,i),await v.cachePlaylistItems(t,n),localStorage.setItem(T.STORAGE_KEYS.LIKED_TRACKS_COUNT,""+a),this.buildTrackUriToPlaylistData(i,n,c)}},A=t=>x.updatePlaylistData(t),I=()=>x.updateLikedTracks(),O=Promise.resolve(),R=new class{constructor(){this.handleRemoveTrack=(a,t)=>{F(a,t);var e,i=P.getState();i.trackUriToPlaylistData[t]&&(e=i.trackUriToPlaylistData[t].filter(t=>t.uri!==a),(i=u({},i.trackUriToPlaylistData))[t]=e,P.setTrackUriToPlaylistData(i)),P.markPlaylistUpdated(),this.updateTracklist()},this.handleNavigateToPlaylist=(t,a)=>{var e=t.isLikedTracks?T.PATHS.LIKED_TRACKS:null==(e=Spicetify.URI.fromString(t.uri))?void 0:e.toURLPath(!0);P.setHighlightTrack(a,e),e&&Spicetify.Platform.History.push({pathname:e,search:"?uid="+t.trackUid})}}updateTracklist(){var t=P.getState(),a=U();P.updateTracklists(a),P.hasTracklistsChanged()&&b.resetLayout();for(const e of t.tracklists)this.processTracklist(e);P.resetPlaylistUpdated()}processTracklist(t){for(const a of H(t))this.processTrackRow(a)}processTrackRow(t){P.getState();this.updateRowHeightIfNeeded(t);var a,e=M(t);e&&(this.handleTrackHighlight(t,e),a=this.getFilteredPlaylistData(e),b.updateMaxExistingLabelCount(a.length),this.handleLabelContainer(t,e,a))}updateRowHeightIfNeeded(t){var t=getComputedStyle(t),a=document.querySelector(T.SELECTORS.STATS_APP),a=(a&&a.style.setProperty("--row-height",t.height),t.getPropertyValue("--row-height"));a&&a!==P.getState().rowHeight&&b.updateRowHeight(a)}handleTrackHighlight(t,a){var e=P.getState();e.highlightTrack===a&&Spicetify.Platform.History.location.pathname===e.highlightTrackPath&&(t.click(),P.setHighlightTrack(null))}getFilteredPlaylistData(t){var a=P.getState();return z(null!=(t=a.trackUriToPlaylistData[t])?t:[],a.showAllPlaylists)}handleLabelContainer(t,a,e){var i=P.getState();let l=t.querySelector("."+S.LABEL_CONTAINER);i.playlistUpdated&&l&&(l.remove(),l=null),!l&&0<e.length&&this.createAndRenderLabels(t,a,e)}createAndRenderLabels(t,a,e){var i=P.getState(),l=B();g.default.render(f.default.createElement(L,{playlistData:e,trackUri:a,maxLabelCount:i.maxLabelCount,onRemoveTrack:this.handleRemoveTrack,onNavigateToPlaylist:this.handleNavigateToPlaylist}),l),K(t,l)}},_=async function(){for(;null==Spicetify||!Spicetify.showNotification;)await new Promise(t=>setTimeout(t,100));var a,t=document.querySelector(T.SELECTORS.MAIN_VIEW),t=(P.setMainView(t),JSON.parse(localStorage.getItem(T.STORAGE_KEYS.SHOW_ALL)||"false")),e=(P.setShowAllPlaylists(t),a=t=>{t.then(t=>{P.setTrackUriToPlaylistData(t),P.markPlaylistUpdated(),R.updateTracklist()})},await Spicetify.Platform.LibraryAPI.getEvents().addListener("update",()=>{O=O.then(()=>I()),a(O)}),await Spicetify.Platform.PlaylistAPI.getEvents().addListener("operation_complete",t=>{O=O.then(()=>A(t.data.uri)),a(O)}),t=t=>{var a=P.toggleShowAllPlaylists();t.active=a,localStorage.setItem(T.STORAGE_KEYS.SHOW_ALL,JSON.stringify(a)),P.markPlaylistUpdated(),R.updateTracklist()},e=`<svg data-encore-id="icon" role="img" viewBox="0 0 16 16" class="Svg-img-icon-small">${Spicetify.SVGIcons.spotify}</svg>`,new Spicetify.Playbar.Button("Show All Saved Playlists",e,t,!1,P.getState().showAllPlaylists),await x.getTrackUriToPlaylistData());P.setTrackUriToPlaylistData(e),C=new MutationObserver(()=>{R.updateTracklist()}),t=new MutationObserver(Z),Z(),t.observe(document.body,{childList:!0,subtree:!0}),t=new ResizeObserver(()=>{b.calculateMaxLabelCount()}),(e=P.getState().mainView)&&t.observe(e)},(async()=>{await _()})();function M(t){var t=t.parentElement;return(t=t&&function(t){var a=t;for(const e of Object.getOwnPropertyNames(a))if(e.startsWith("__reactFiber$")||e.startsWith("__reactInternalInstance$"))return a[e];return null}(t))&&(t=function(a,e){if(a){let t=a.return;for(;t;){var i=t.memoizedProps||t.pendingProps;if(i&&(!e||e(t)))return i;t=t.return}}return null}(t,t=>{t=t.memoizedProps||t.pendingProps;return t&&t.uri}))?t.uri:null}function N(t,a){document.documentElement.style.setProperty(t,a)}function U(){return Array.from(document.querySelectorAll(T.SELECTORS.TRACKLIST))}function H(t){return t.getElementsByClassName("main-trackList-trackListRow")}function B(){var t=document.createElement("div");return t.classList.add("spicetify-playlist-labels"),t}function K(t,a){t=t.querySelector(T.SELECTORS.LAST_COLUMN);t&&t.insertBefore(a,t.firstChild)}async function j(){return Spicetify.Platform.RootlistAPI.getContents({decorateImagesAndOwner:!0})}async function V(){return(await Spicetify.Platform.LibraryAPI.getTracks()).totalLength}async function G(t){return(await Spicetify.Platform.PlaylistAPI.getContents(t)).items}async function W(t){var a=await v.getDb(),e=await v.getCachedPlaylistMetadata(a,t);return e||(e=await Spicetify.Platform.PlaylistAPI.getMetadata(t),await v.cachePlaylistMetadata(a,e),e)}async function F(t,a){await Spicetify.Platform.PlaylistAPI.remove(t,[{uri:a,uid:""}])}async function q(){return Spicetify.Platform.LibraryAPI.getTracks({limit:Number.MAX_SAFE_INTEGER})}function z(t,a){return t.filter(t=>{return!(!a&&!t.isOwnPlaylist)&&((t=t).isLikedTracks?"/collection/tracks"!==Spicetify.Platform.History.location.pathname:(t=null==(t=null==(t=t.uri)?void 0:t.match(/spotify:playlist:(.*)/))?void 0:t[1],Spicetify.Platform.History.location.pathname!=="/playlist/"+t))})}function Y(t){return t.sort((t,a)=>new Date(t.addedAt).getTime()-new Date(a.addedAt).getTime())}function $(t){return[t.filter(t=>t.isRatedPlaylist),t.filter(t=>!t.isRatedPlaylist)]}function X(t,a){return!a||a.totalLength!==t.totalLength}function D(t){const a={};return t.forEach(t=>{a[t.uri]=t.items}),a}async function Z(){var t=document.querySelector(T.SELECTORS.MAIN);P.updateMainElement(t),P.hasMainElementChanged()&&((t=P.getState()).oldMainElement&&C.disconnect(),R.updateTracklist(),t.mainElement)&&C.observe(t.mainElement,{childList:!0,subtree:!0})}(async()=>{var t;document.getElementById("spicetifyDplaylistDlabels")||((t=document.createElement("style")).id="spicetifyDplaylistDlabels",t.textContent=String.raw`
  :root{--spicetify-playlist-labels-size:28px;--spicetify-playlist-labels-gap:6px;--spicetify-playlist-labels-container-max-width:calc( ( var(--spicetify-playlist-labels-size) + var(--spicetify-playlist-labels-gap) ) * var(--spicetify-playlist-labels-max-label-count, 1) + 16px );--spicetify-playlist-labels-container-width:min( var(--spicetify-playlist-labels-container-max-width), calc( var(--spicetify-playlist-labels-size) * var(--spicetify-playlist-labels-label-count, 1) + var(--spicetify-playlist-labels-gap) * calc(var(--spicetify-playlist-labels-label-count, 1) - 1) ) )}.spicetify-playlist-labels-labels-container{width:var(--spicetify-playlist-labels-container-width);height:var(--row-height);align-items:center;display:flex;flex-direction:row-reverse;overflow:hidden;gap:var(--spicetify-playlist-labels-gap);justify-content:flex-start;max-width:var(--spicetify-playlist-labels-container-max-width)}.spicetify-playlist-labels-labels-container:after{content:"\22ef";display:none;color:var(--text-base)}.spicetify-playlist-labels-labels-container.spicetify-playlist-labels-overflow:after{display:block}.spicetify-playlist-labels-label-container{position:relative;height:calc(var(--row-height) * .5)}.spicetify-playlist-labels-label-container>img{width:calc(var(--row-height) * .5);height:100%;-o-object-fit:cover;object-fit:cover;border-radius:calc(var(--row-height) * .5 * .1)}.main-trackList-trackList.main-trackList-indexable[aria-colcount="4"] .main-trackList-trackListRowGrid{grid-template-columns:[index] var(--tracklist-index-column-width,16px) [first] minmax(120px,var(--col1,4fr)) [var1] minmax(120px,var(--col2,2fr)) [last] calc(120px + var(--spicetify-playlist-labels-container-width) + 12px)!important}.main-trackList-trackList.main-trackList-indexable[aria-colcount="5"] .main-trackList-trackListRowGrid{grid-template-columns:[index] var(--tracklist-index-column-width,16px) [first] minmax(120px,var(--col1,6fr)) [var1] minmax(120px,var(--col2,4fr)) [var2] minmax(120px,var(--col3,3fr)) [last] calc(120px + var(--spicetify-playlist-labels-container-width) + 12px)!important}.main-trackList-trackList.main-trackList-indexable[aria-colcount="6"] .main-trackList-trackListRowGrid{grid-template-columns:[index] var(--tracklist-index-column-width,16px) [first] minmax(120px,var(--col1,6fr)) [var1] minmax(120px,var(--col2,4fr)) [var2] minmax(120px,var(--col3,3fr)) [var3] minmax(120px,var(--col4,2fr)) [last] calc(120px + var(--spicetify-playlist-labels-container-width) + 12px)!important}
      `.trim(),document.head.appendChild(t))})()}();